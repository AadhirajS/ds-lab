# Import libraries
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import PolynomialFeatures
from sklearn.pipeline import Pipeline
from sklearn.svm import SVR
from sklearn.metrics import mean_absolute_error, mean_squared_error
from sklearn.cluster import KMeans

# 1. Load Dataset
df = pd.read_csv('Advertising.csv')
print(df.head())

# 2. Explore & Preprocess
print(df.isnull().sum())
print(df.dtypes)

features = ['TV', 'Radio', 'Newspaper']
target = 'Sales'

sns.pairplot(df[features + [target]])
plt.show()

X = df[features]
y = df[target]

# 3. Split Data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 4. Linear Regression
lin_reg = LinearRegression()
lin_reg.fit(X_train, y_train)
y_pred_lin = lin_reg.predict(X_test)

# 5. Polynomial Regression (degree 2)
poly_model = Pipeline([
    ('poly_features', PolynomialFeatures(degree=2)),
    ('lin_reg', LinearRegression())
])
poly_model.fit(X_train, y_train)
y_pred_poly = poly_model.predict(X_test)

# 6. Support Vector Regression
svr_model = SVR(kernel='rbf')
svr_model.fit(X_train, y_train)
y_pred_svr = svr_model.predict(X_test)

# 7. Evaluate Models
models = ['Linear', 'Polynomial', 'SVR']
mae = [
    mean_absolute_error(y_test, y_pred_lin),
    mean_absolute_error(y_test, y_pred_poly),
    mean_absolute_error(y_test, y_pred_svr)
]
mse = [
    mean_squared_error(y_test, y_pred_lin),
    mean_squared_error(y_test, y_pred_poly),
    mean_squared_error(y_test, y_pred_svr)
]
rmse = [np.sqrt(m) for m in mse]

eval_df = pd.DataFrame({'Model': models, 'MAE': mae, 'MSE': mse, 'RMSE': rmse})
print(eval_df)

# Bar graph comparison
eval_df.set_index('Model')[['MAE', 'MSE', 'RMSE']].plot.bar()
plt.title('Model Comparison')
plt.ylabel('Error')
plt.show()

# 8. K-Means Clustering
kmeans = KMeans(n_clusters=3, random_state=42)
df['Cluster'] = kmeans.fit_predict(df[features])

# 9. Visualize Clusters
sns.scatterplot(data=df, x='TV', y='Sales', hue='Cluster', palette='viridis')
plt.title('K-Means Clusters (TV vs Sales)')
plt.show()
